<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
	<style type="text/css">
		body, html {width: 100%;height: 100%;margin:0;font-family:"微软雅黑";}
		#mapx{width:100%;height:500px;}
		p{margin-left:5px; font-size:14px;}
	</style>
	<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=uZUxQ6aCPUE3fHeHYYtDqgCj"></script>
	<script type="text/javascript" src="http://api.map.baidu.com/library/TextIconOverlay/1.2/src/TextIconOverlay_min.js"></script>
	<script type="text/javascript" src="http://api.map.baidu.com/library/MarkerClusterer/1.2/src/MarkerClusterer_min.js"></script>
	<title>根据关键字本地搜索</title>
</head>
<body>
	<div id="mapx"></div>
    <div id="r-result"></div>
	<div>
        <input type="text" /> startTime <br />
        <input type="text" /> endTime <br />
        <button onclick="func()">
            Get
        </button>
    </div>
</body>
    <script src="http://libs.baidu.com/jquery/1.9.0/jquery.js"></script>
</html>
<script type="text/javascript">
	// 百度地图API功能
	var map1 = new BMap.Map("mapx");          
	map1.centerAndZoom(new BMap.Point(116.404, 39.915), 4);
    map1.enableScrollWheelZoom();
    map1.setMapStyle({style:'grayscale'});
    
    var myGeo = new BMap.Geocoder();
    var myIcon = new BMap.Icon("/images/pin.png", new BMap.Size(32,32));
    

    function func(){
        //bdGEO();
        
        $.getJSON('http://localhost/server/test.php', function(data){
            for ( var idx =0; idx < data.length; idx++ ){
                //console.log( data[idx].title, data[idx].location );
                console.log(data[idx]);
                (function(obj){myGeo.getPoint( obj.location, function(point){
                    if (point){
                        var addr = new BMap.Point(point.lng, point.lat);
                        addMarker2( addr, obj );
                    }
                }, "中国");})(data[idx]);
            }
        })
    }
    
    function buildInfo( obj ){
        console.log(obj);
        head = '<h2>' + obj.location + '</h2>';
        title = '<h4>' + obj.title + '</h4>';
        body = '<p>' + obj.content + '<p>';
        return head + title+ body;
    }
    
    function addMarker2( point , obj ){
        var marker = new BMap.Marker(point, {icon:myIcon, offset:new BMap.Size(0, -16)});
        map1.addOverlay(marker);
        
        var win = new BMap.InfoWindow( buildInfo( obj ) );
        
        marker.addEventListener('click', function(){
            this.openInfoWindow(win);
        })
    }
    
</script>
